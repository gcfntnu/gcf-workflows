#-*- mode:snakemake -*-
"""
Mituyama T, Yamada K, Hattori E, Okida H, Ono Y, Terai G, Yoshizawa A, Komori T, Asai K.
The Functional RNA Database 3.0: databases to support mining and annotation of functional RNAs.
Nucleic Acids Research/2009/D89-92
"""

FRNADB_CONF = config['db'].get('frnadb')
if FRNADB_CONF is None:
    FRNADB_CONF = config['db']['frnadb'] = {}
FRNADB_RELEASE = config['db']['frnadb'].get('release')
if FRNADB_RELEASE is None:
    FRNADB_RELEASE = config['db']['frnadb']['release'] = '20160329'

FRNADB_ORG = {'homo_sapiens': 'Homo_sapiens',
      	      'human': 'Homo_sapiens',			
              'mus_musculus': 'Mus_musculus',	
              'mouse': 'Mus_musculus',
              'rattus_norvegicus': 'Rattus_norvegicus',
              'rat': 'Rattus_norvegicus',
              'rno': 'Rattus_norvegicus'}

rule frnadb_fasta:
    params:
        url = 'ftp://ftp.biosciencedbc.jp/archive/frnadb/{}/Sequence_Data/{}.zip'.format(FRNADB_RELEASE, FRNADB_ORG[ORG]),
        proxy = config.get('proxy', {}).get('wget', '')
    output:
        fasta = join(EXT_DIR, 'frnadb', ORG, 'release-{}'.format(FRNADB_RELEASE), 'fasta', 'frna.fa')
    log:
        join(EXT_DIR, 'frnadb', ORG, 'release-{}'.format(FRNADB_RELEASE), 'logs', 'frna.log')
    shell:
        """
        wget {params.proxy} -O temp.zip {params.url} 
        unzip -p temp.zip > {output.fasta}
        rm temp.zip
        echo "Functional RNA Database,{FRNADB_RELEASE},{params.url},`date -I`" > {log}
        """

rule frnadb_db_all:
    input:
        rules.frnadb_fasta.output
        

def get_frnadb(wildcards):
    pass
