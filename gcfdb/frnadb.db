#-*- mode:snakemake -*-
"""
Mituyama T, Yamada K, Hattori E, Okida H, Ono Y, Terai G, Yoshizawa A, Komori T, Asai K.
The Functional RNA Database 3.0: databases to support mining and annotation of functional RNAs.
Nucleic Acids Research/2009/D89-92
"""

FRNADB_CONF = config['db'].get('frnadb')
if FRNADB_CONF is None:
    FRNADB_CONF = config['db']['frnadb'] = {}
FRNADB_VERSION = config['db']['frnadb'].get('version')
if FRNADB_VERSION is None:
    FRNADB_VERSION = config['db']['frnadb']['version'] = '20160329'

FRNADB_ORG = {'homo_sapiens': 'Homo_sapiens',
      	      'human': 'Homo_sapiens',			
              'mus_musculus': 'Mus_musculus',	
              'mouse': 'Mus_musculus',
              'rattus_norvegicus': 'Rattus_norvegicus',
              'rat': 'Rattus_norvegicus',
              'rno': 'Rattus_norvegicus'}

rule frnadb_fasta:
    params:
        url = 'ftp://ftp.biosciencedbc.jp/archive/frnadb/{}/Sequence_Data/{}.zip'.format(FRNADB_VERSION, FRNADB_ORG[ORG]),
        date = datetime.now().strftime("%d-%m-%Y")
    output:
        fasta = join(EXT_DIR, 'frnadb', ORG, 'release-{}'.format(FRNADB_VERSION), 'fasta', 'frna.fa')
    log:
        join(EXT_DIR, 'frnadb', ORG, 'release-{}'.format(FRNADB_VERSION), 'logs', 'frna.log')
    shell:
        """
        wget -O temp.zip {params.url} 
        unzip -p temp.zip > {output.fasta}
        rm temp.zip
        echo "Functional RNA Database,{FRNADB_VERSION},{params.url},{params.date}" > {log}
        """

rule frnadb_db_all:
    input:
        rules.frnadb_fasta.output
        
