#-*- mode:snakemake -*-
"""
http://seqanswers.com/forums/archive/index.php/t-42552.html
bbmap.sh in=ref.fa 
bbduk.sh -Xmx1g in=reads.fq out=clean.fq ref=phix.fasta k=31 hdist=1

quote:
Those are common contaminant microbes that we encounter in sequencing. For Eukaryotic genomes, I suggest mapping against fusedEPmasked2, in which the bacteria are masked for entropy and plastids (e.g. chloroplast) only. The other one (fusedERPBBmasked2) is intended for Prokaryotic assembly and is masked for conserved regions in bacteria, including ribosomes.


"""


rule jgi_bacterial_eukaryot:
    params:
        url = 'http://portal.nersc.gov/dna/microbial/assembly/bushnell/fusedEPmasked2.fa.gz',
        date = datetime.now().strftime("%d-%m-%Y")
    output:
        join(EXT_DIR, 'JGI', 'fasta', 'fusedEPmasked2.fa')
    log:
       join(EXT_DIR, 'JGI', 'logs', 'fusedEPmasked2.log') 
    shell:
        """
        wget -O- {params.url}  | gunzip -c | sed 's/ /_/g' > {output}
        echo "Masked bacterial genomes,NA,{params.url},{params.date}" > {log}
        """

rule jgi_bacterial_prokaryot:
    params:
        url = 'http://portal.nersc.gov/dna/microbial/assembly/bushnell/fusedERPBBmasked2.fa.gz',
        date = datetime.now().strftime("%d-%m-%Y")
    output:
        join(EXT_DIR, 'JGI', 'fasta', 'fusedERPBBmasked2.fa.gz')
    log:
       join(EXT_DIR, 'JGI', 'logs', 'fusedERPBBmasked2.log') 
    shell:
        """
        wget -O- {params.url}  | gunzip -c | sed 's/ /_/g' > {output}
        echo "Masked bacterial genomes,NA,{params.url},{params.date}" > {log}
        """

rule jgi_ribokmers:
    params:
        url = 'http://portal.nersc.gov/dna/microbial/assembly/bushnell/riboKmers.fa.gz',
        date = datetime.now().strftime("%d-%m-%Y")
    output:
        join(EXT_DIR, 'JGI', 'fasta', 'ribokmers.fa.gz')
    log:
       join(EXT_DIR, 'JGI', 'logs', 'ribokmers.log')     
    shell:
        """
        wget {params.url} -O- > {output}
        echo "RiboKmers,NA,{params.url},{params.date}" > {log}
        """
    
rule jgi_db_all:
    input:
        join(EXT_DIR, 'JGI', 'fasta', 'fusedEPmasked2.fa'),
        join(EXT_DIR, 'JGI', 'fasta', 'fusedERPBBmasked2.fa.gz'),
        join(EXT_DIR, 'JGI', 'fasta', 'ribokmers.fa.gz')        
