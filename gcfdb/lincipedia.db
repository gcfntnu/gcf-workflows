#-*- mode:snakemake -*-
"""
LNCipedia A comprehensive compendium of human long non-coding RNAs

https://lncipedia.org/download

https://lncipedia.org/downloads/lncipedia_5_2/full-database/lncipedia_5_2_hg38.gtf
https://lncipedia.org/downloads/lncipedia_5_2/lncipedia_5_2_ensembl_92_genes.txt

"""

# config
extra_conf_fn = srcdir('lncipedia.config')
if os.path.exists(extra_conf_fn):
    with open(extra_conf_fn) as fh:
        c  = yaml.load(fh, Loader=Loader) or {}
        update_config2(config, c)

RELEASE = config['db']['lincipedia']['release']
try:
    number = float(RELEASE)
    maj, min = str(number).split('.')
    RELEASE = '{}_{}'.format(maj, min)
except:
    pass

URL = 'https://lncipedia.org/downloads/lincipedia_{}'.format(RELEASE)
LNC_FASTA = join(URL, 'high-confidence-set/lncipedia_{}_hc.fasta'.format(RELEASE))

ASSEMBLY = 'hg38' if config['db']['assembly'] == 'GRCh38' else 'hg37'

LNC_GTF = join(URL, 'full-database', 'lncipedia_{}_{}.gtf'.format(RELEASE, ASSEMBLY))


rule lincipedia_noncoding_hc:
    input:
        HTTP.remote(LNC_FASTA)
    params: 
        date = datetime.now().strftime("%d-%m-%Y")
    output:
        join(OUTDIR, 'fasta', os.path.basename(LNC_FASTA))
    threads:
        4
    log:
        join(OUTDIR, 'logs', 'lincipedia.noncoding.log')
    shell: 
        """
        cat {input} > {output}
        echo 'LNCipedia High confidence,{LNC_RELEASE},{LNC_FASTA},{params.date}' > {log}
        """

rule lincipedia_gtf:
    input:
        HTTP.remote(LNC_GTF)
    output:
        join(OUTDIR, 'genes', os.path.basename(LNC_GTF))
    threads:
        4
    log:
        join(OUTDIR, 'logs', 'lincipedia.gtf.log')
    shell:
        """
        cat {input} > {output}
        echo 'LNCipedia GTF,{LNC_RELEASE},{LNC_GTF},{params.date}' > {log}
        """

                 
